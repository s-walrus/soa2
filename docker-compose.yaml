version: "3.9"

services:
  # provides core gameplay logic
  game-core:
    build:
      context: ./services/core/
      dockerfile: Dockerfile
    ports:
      - "8080:5000"
    depends_on:
      - chat

  # stores game-related information
  game-info:
    build:
      context: ./services/info/
      dockerfile: Dockerfile
    # command: "./run"
    ports:
      - "8081:5000"
    networks:
      - app-tier
    depends_on:
      - game-info-db

  game-info-db:
    image: 'bitnami/redis:latest'
    environment:
      - ALLOW_EMPTY_PASSWORD=yes
    networks:
      - app-tier

  # message queue for the in-game chat
  chat:
    image: 'bitnami/rabbitmq:latest'
    ports:
      - '15672:15672'
      - '5672:5672'

networks:
  app-tier:
    driver: bridge
